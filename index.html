<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Battle Royale Web Game</title>
<style>
body{margin:0;overflow:hidden;background:black}
#ui{position:fixed;top:10px;left:10px;color:#0f0;font-family:monospace}
#msg{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);color:red;font-size:40px;display:none}
</style>
</head>
<body>

<div id="ui">HP: <span id="hp">100</span></div>
<div id="msg">YOU DIED</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>

<script>
// ---------- BASIC SETUP ----------
let scene=new THREE.Scene();
let camera=new THREE.PerspectiveCamera(75,innerWidth/innerHeight,0.1,1000);
let renderer=new THREE.WebGLRenderer();
renderer.setSize(innerWidth,innerHeight);
document.body.appendChild(renderer.domElement);

// ---------- PLAYER ----------
let playerHP=100;
let playerGeo=new THREE.BoxGeometry(1,1,1);
let playerMat=new THREE.MeshBasicMaterial({color:0x00ff00});
let player=new THREE.Mesh(playerGeo,playerMat);
scene.add(player);
camera.position.set(0,5,10);
camera.lookAt(player.position);

// ---------- FLOOR ----------
let floor=new THREE.Mesh(
  new THREE.PlaneGeometry(100,100),
  new THREE.MeshBasicMaterial({color:0x222222,side:THREE.DoubleSide})
);
floor.rotation.x=Math.PI/2;
scene.add(floor);

// ---------- ENEMIES ----------
let enemies=[];
function spawnEnemy(){
  let e=new THREE.Mesh(
    new THREE.BoxGeometry(1,1,1),
    new THREE.MeshBasicMaterial({color:0xff0000})
  );
  e.position.set(
    (Math.random()-0.5)*40,
    0.5,
    (Math.random()-0.5)*40
  );
  e.hp=30;
  scene.add(e);
  enemies.push(e);
}
for(let i=0;i<5;i++) spawnEnemy();

// ---------- CONTROLS ----------
let keys={};
document.addEventListener("keydown",e=>keys[e.key]=true);
document.addEventListener("keyup",e=>keys[e.key]=false);

// ---------- SHOOT ----------
let bullets=[];
document.addEventListener("click",()=>{
  let b=new THREE.Mesh(
    new THREE.SphereGeometry(0.1),
    new THREE.MeshBasicMaterial({color:0xffff00})
  );
  b.position.copy(player.position);
  b.dir=new THREE.Vector3(0,0,-1);
  scene.add(b);
  bullets.push(b);
});

// ---------- GAME LOOP ----------
function animate(){
  requestAnimationFrame(animate);

  // movement
  if(keys.w) player.position.z-=0.2;
  if(keys.s) player.position.z+=0.2;
  if(keys.a) player.position.x-=0.2;
  if(keys.d) player.position.x+=0.2;

  camera.position.x=player.position.x;
  camera.position.z=player.position.z+10;

  // bullets
  bullets.forEach((b,i)=>{
    b.position.add(b.dir.clone().multiplyScalar(0.8));
    enemies.forEach((e,ei)=>{
      if(b.position.distanceTo(e.position)<0.8){
        e.hp-=10;
        scene.remove(b);
        bullets.splice(i,1);
        if(e.hp<=0){
          scene.remove(e);
          enemies.splice(ei,1);
          spawnEnemy();
        }
      }
    });
  });

  // enemies attack
  enemies.forEach(e=>{
    e.lookAt(player.position);
    e.position.add(
      e.getWorldDirection(new THREE.Vector3()).multiplyScalar(0.03)
    );
    if(e.position.distanceTo(player.position)<1){
      playerHP-=0.2;
      document.getElementById("hp").innerText=Math.floor(playerHP);
    }
  });

  if(playerHP<=0){
    document.getElementById("msg").style.display="block";
    return;
  }

  renderer.render(scene,camera);
}
animate();
</script>
</body>
</html>
